<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="inherit_sale_quotations" name="template_name" inherit_id="l10n_din5008.external_layout_din5008">
        <!-- logo position change -->
        <xpath expr="//table[contains(@class,'company_header')]" position="replace">
            <div>
               
            
            </div>
        </xpath>
        <!--customer information block -->
        <xpath expr="//div[contains(@t-attf-class, 'din_page invoice_note')]" position="replace">
            <div t-attf-class="din_page invoice_note article o_company_#{company.id}_layout {{'o_report_layout_background' if company.layout_background in ['Geometric', 'Custom']  else  ''}} #{'din_page_pdf' if report_type == 'pdf' else ''}"
                     t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % company.layout_background_image.decode('utf-8') if company.layout_background_image and company.layout_background == 'Custom' else '/base/static/img/bg_background_template.jpg' if company.layout_background == 'Geometric' else ''}});"
                     t-att-data-oe-model="o and o._name"
                     t-att-data-oe-id="o and o.id">
                <div class="title_source_div">
                    <strong class="title_source">
                        <span t-if="o.state not in ['draft','sent']">AUFTRAGSBESTÄTIGUNG
                            <br/>N .:
                            <span t-field="o.name"/></span>
                        <span t-if="o.state in ['draft','sent']">OFFERT
                            <br/>N .:
                            <span t-field="o.name"/></span>
                    </strong>
                </div>
                <div class="row information_block">
                    <div class="col-5">
                        <strong class="title">
                            <t t-if="o.partner_id">
                                <span t-field="o.partner_id.name"/>
                            </t>
                        </strong>
                        <br/>
                        <span t-field="o.partner_id.street"/>
                        <br/>
                        <span t-field="o.partner_id.zip"/>
                        <span t-field="o.partner_id.state_id.code"/>
                        <span t-field="o.partner_id.city"/>
                        <br/>
                        <span t-field="o.partner_id.country_id"/>
                    </div>
                    <div class="col-7">
                        <div class="row">
                            <!-- Right-aligned column -->
                            <div class="col-4 text-start">
                                <!-- State-based labels -->
                                <span t-if="o.state in ['draft','sent']">Datum
                                    <br/>
                                </span>
                                <span t-if="o.state not in ['draft','sent']">Datum
                                    <br/>
                                </span>
                                <span t-if="o.state in ['draft','sent']">Ansprechpartner
                                    <br/>
                                </span>
                                <span t-if="o.state not in ['draft','sent']">Ansprechpartner
                                    <br/>
                                </span>
                                <!-- User contact details -->
                                <span t-if="o.user_id.phone">Telefon
                                    <br/>
                                </span>
                                <span t-if="o.user_id.email">Email</span>
                            </div>
                            <!-- Left-aligned column -->
                            <div class="col-6 text-start">
                                <!-- Date based on state -->
                                <span t-if="o.state in ['draft','sent']">
                                    <span t-field="o.create_date" t-options="{'widget':'date'}"/>
                                    <br/>
                                </span>
                                <span t-if="o.state not in ['draft','sent']">
                                    <span t-field="o.date_order" t-options="{'widget':'date'}"/>
                                    <br/>
                                </span>
                                <!-- User details -->
                                <span t-if="o.state in ['draft','sent']">
                                    <span t-field="o.user_id"/>
                                    <br/>
                                </span>
                                <span t-if="o.state not in ['draft','sent']">
                                    <span t-field="o.user_id.name"/>
                                    <br/>
                                </span>
                                <!-- Contact details -->
                                <span t-if="o.user_id.phone">
                                    <span t-field="o.user_id.phone"/>
                                    <br/>
                                </span>
                                <span t-if="o.user_id.email">
                                    <span t-field="o.user_id.email"/>
                            </span>
                            </div>
                            <div class="col-2 pull-right" style="position: relative;">
                                <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" class="logo-image" t-att-style="'max-height: %dmm;' % (din_header_spacing or 27)"/>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Notes -->
                <div class="note_block">
                    <t t-if="o.state in ['draft','sent']">
                        <b>
                            <span style="line-height: 250%; " t-field="o.sale_subject"/>
                        </b>
                        <br/>
                        <span style="line-height: 200%; " t-field="o.cover_note_quot"/>
                        <br/>
                    </t>
                    <t t-if="o.state not in ['draft','sent']">
                        <b>
                            <span style="line-height: 200%; " t-field="o.sale_order_subject"/>
                        </b>
                        <br/>
                        <span style="line-height: 200%; " t-field="o.cover_note_sale"/>
                        <br/>
                    </t>
                </div>
                <br/>
                <br/>
                <!-- Product Table -->
                <table class="table table-sm o_main_table table-borderless">
                    <thead style="border-bottom: 0.5px solid black;">
                        <tr>
                            <th style="width:100px; border-top: 0px solid white !important;border-bottom: 1px solid black;">Position</th>
                            <th style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Produkt</th>
                            <th style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Imagen</th>
                            <th class="text-right" style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Preis/Stück</th>
                            <th class="text-right" style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Stück</th>
                            <th class="text-right" style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Disc.</th>
                            <th class="text-right" style="border-top: 0px solid white !important;border-bottom: 1px solid black;">Summe</th>
                        </tr>
                    </thead>
                    <tbody class="sale_tbody">
                        <t t-set="current_subtotal" t-value="0"/>
                        <t t-foreach="o.order_line" t-as="line">
                            <tr>
                                <td style="vertical-align: middle;">
                                    <strong>
                                        <span t-field="line.position"/>
                                    </strong>
                                </td>
                                <td style="vertical-align: middle;">
                                    <span t-field="line.name"/>
                                </td>
                                <td style="vertical-align: middle;">
                                    <img t-if="line.product_id.image_1920" t-att-src="image_data_uri(line.product_id.image_1920)" width="50px" height="50px" />
                                </td>
                                <td class="text-center" style="text-align: center; vertical-align: middle;">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td class="text-center" style="vertical-align: middle;">
                                    <t t-esc="int(line.product_uom_qty)"/>
                                </td>
                                <td class="text-center" style="vertical-align: middle;">
                                    <span t-field="line.discount"/>%
                                </td>
                                <td class="text-center" style="vertical-align: middle;">
                                    <span t-field="line.price_subtotal"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
                <table class="table" style="border-bottom: 0.5px solid black !important;">
                    <t t-set="discount" t-value="sum(line.price_subtotal for line in o.order_line if line.price_subtotal and line.price_subtotal &lt; 0) or 0"/>
                    
                    <t t-set="total_price" t-value="sum(line.price_subtotal for line in o.order_line if line.price_subtotal and line.price_subtotal &gt; 0)"/>
                    
                    <tr>
                        <td style="padding:0px; margin:0px; border-top: 1px solid black; vertical-align: middle;">Summe netto</td>
                        <td class="text-right" style="padding:0px; margin:0px; border-top: 1px solid black; vertical-align: middle;">
                            <span t-field="o.amount_untaxed"/>
                        </td>
                    </tr>
                    <tr style="height: -2px;">
                        <td style="padding:0px; margin:0px; vertical-align: middle;">Konditionen
                            <![CDATA[&nbsp;]]>
                            <span t-esc="discount if discount==0 else round(abs(discount)/total_price*100)"/>%
                        </td>
                        <td class="text-right" style="padding:0px; margin:0px; vertical-align: middle;">
                            <span t-esc="abs(discount)"/> €
                        </td>
                    </tr>
                    <tr style="height: -2px;" t-if="o.amount_undiscounted">
                        <td style="padding:0px; margin:0px; vertical-align: middle;">Zwischensumme</td>
                        <td class="text-right" style="padding:0px; margin:0px; vertical-align: middle;">
                             <span t-esc="total_price"/> €
                        </td>
                    </tr> 
                     <tr style="height: 2px;">
                        <t t-if="o.amount_tax &gt; 0">
                             <t t-set="taxes" t-value="o.show_tax()"/>
                            <td style="padding:0px; margin:0px; vertical-align: middle;">
                                <t t-foreach="taxes['tax_groups']" t-as="tax_des">
                                    <span t-esc="tax_des"/>
                                </t>
                            </td>
                            <td class="text-right" style="padding:0px; margin:0px; vertical-align: middle;">
                                <span t-field="o.amount_tax"/>
                            </td>
                        </t>
                    </tr>
                    <tr style="height: 20px;">
                        <td style="padding:0px; margin:0px; vertical-align: middle;" width="10">
                            <b>Gesamtsumme</b>
                        </td>
                        <td class="text-right" style="padding:0px; margin:0px; vertical-align: middle;" width="10">
                            <b>
                                <span t-field="o.amount_total"/>
                            </b>
                        </td>
                    </tr>
                </table>
            </div>
        </xpath>
    </template>
</odoo>